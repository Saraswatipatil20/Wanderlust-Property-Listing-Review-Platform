<% layout("/layouts/boilerplate") %>

<!-- ===== Title + Card Section ===== -->
<div class="row mt-4">
  <div class="col-8 offset-2">

    <h3 class="mb-3"><%= listing.title %></h3>

    <div class="card show-card listing-card">
      <img 
        src="<%= listing.image?.url || '/images/default-image.jpg' %>" 
        class="card-img-top show-img" 
        alt="listing image"
        style="height: 400px; object-fit: cover;"
      />

      <div class="card-body">
        <p class="card-text"><%= listing.description %></p>

        <p class="card-text">
          <strong>Price:</strong>
          â‚¹ <%= listing.price?.toLocaleString('en-IN') || 'Not available' %>/night
        </p>

        <p class="card-text">
          <strong>Location:</strong>
          <%= listing.location %>, <%= listing.country %>
        </p>
      </div>
    </div>

  </div>
</div>



<!-- ===== Buttons Section ===== -->
<div class="row mt-3">
  <div class="col-8 offset-2 d-flex gap-3">

    <a 
      href="/listing/<%= listing._id %>/edit"
      class="btn btn-outline-secondary"
    >
      EDIT
    </a>

    <form 
      action="/listing/<%= listing._id %>?_method=DELETE" 
      method="POST"
    >
      <button 
        type="submit" 
        class="btn btn-outline-danger"
      >
        DELETE
      </button>
    </form>

  </div>
</div>



<!-- ===== Review Section ===== -->
<div class="row mt-4">
  <div class="col-8 offset-2">

    <hr>
    <h4 class="mb-3">Leave a Review</h4>

    <form 
        action="/listing/<%= listing._id %>/review" 
        method="POST"
        class="needs-validation"
         novalidate >

      <div class="mb-3">
        <label class="form-label">Rating</label>
        <input 
          type="range"
          name="review[rating]"
          min="1"
          max="5"
          step="1"
          class="form-range"
          required
        >
      </div>

      <div class="mb-3">
        <label class="form-label">comment</label>
        <textarea 
          name="review[comment]"
          rows="4"
          class="form-control"
          required
        ></textarea>
        <div class="invalid-feedback"> Please submit some comments for review</div>
      </div>

      <button 
        type="submit" 
        class="btn btn-info"
      >
        Submit Review
      </button>

    </form>
<hr>
 <p><b> All Reviews</b></p>

 <div class="row">
   <% for( let review of listing.reviews) {%> 
     <div class="card col-5 ms-3 mb-3"> 
        <div class="card-body">
          <h5 class="card-title"> user-name</h5>
           <p class="card-text">  <%= review.comment %></p>
          <p class="card-text">  <%= review.rating %></p>
        </div>
    <form class="mb-3" method="POST" action="/listing/<%=listing._id %>/reviews/<%=review._id %>?_method=DELETE">
      <button class="btn btn-sm btn-dark">
        Delete
      </button>
      <br>
    </form>
     </div> 
         <% } %>

     <div>
 
     </div>
   </div>
   <script src="/css/js/script.js"></script>
